---
title: Run the MongoDB Connector Externally
description: Configure MongoDB ingestion via YAML to extract collection metadata, schema, and profiling insights from NoSQL datasets.
slug: /connectors/database/mongodb/yaml
sidebarTitle: Run Externally
mode: "wide"
---
import { ConnectorDetailsHeader } from '/snippets/components/ConnectorDetailsHeader/ConnectorDetailsHeader.jsx'
import { CodePreview, ContentPanel, ContentSection, CodePanel } from '/snippets/components/CodePreview.jsx'
import IngestionSinkDef from '/snippets/connectors/yaml/ingestion-sink-def.mdx'
import WorkflowConfigDef from '/snippets/connectors/yaml/workflow-config-def.mdx'
import IngestionCli from '/snippets/connectors/yaml/ingestion-cli.mdx'
import PythonRequirements from '/snippets/connectors/python-requirements.mdx'
import ExternalIngestionDeployment from '/snippets/connectors/external-ingestion-deployment.mdx'
import IngestionSink from '/snippets/connectors/yaml/ingestion-sink.mdx'
import WorkflowConfig from '/snippets/connectors/yaml/workflow-config.mdx'
import SourceConfigDef from '/snippets/connectors/yaml/database/source-config-def.mdx'
import SourceConfig from '/snippets/connectors/yaml/database/source-config.mdx'

<ConnectorDetailsHeader
icon='/public/images/connectors/mongodb.webp'
name="MongoDB"
stage="PROD"
availableFeatures={["Metadata", "Data Profiler", "Sample Data", "Auto-Classification"]}
unavailableFeatures={["Query Usage", "Data Quality", "dbt", "Owners", "Lineage", "Column-level Lineage", "Tags", "Stored Procedures"]} />
In this section, we provide guides and references to use the MongoDB connector.
Configure and schedule MongoDB metadata workflows from the OpenMetadata UI:
- [Requirements](#requirements)
- [Metadata Ingestion](#metadata-ingestion)
- [Data Profiler](#data-profiler)
<ExternalIngestionDeployment />
## Requirements
To fetch the metadata from MongoDB to OpenMetadata, the MongoDB user must have access to perform `find` operation on collection and `listCollection` operations on database available in MongoDB.
### Python Requirements
<PythonRequirements />
To run the MongoDB ingestion, you will need to install:
```bash
pip3 install "openmetadata-ingestion[mongo]"
```
## Metadata Ingestion
All connectors are defined as JSON Schemas.
[Here](https://github.com/open-metadata/OpenMetadata/blob/main/openmetadata-spec/src/main/resources/json/schema/entity/services/connections/database/mongoDBConnection.json)
you can find the structure to create a connection to MongoDB.
In order to create and run a Metadata Ingestion workflow, we will follow
the steps to create a YAML configuration able to connect to the source,
process the Entities if needed, and reach the OpenMetadata server.
The workflow is modeled around the following
[JSON Schema](https://github.com/open-metadata/OpenMetadata/blob/main/openmetadata-spec/src/main/resources/json/schema/metadataIngestion/workflow.json)
### 1. Define the YAML Config

This is a sample config for MongoDB:

<CodePreview>

<ContentPanel>

<ContentSection id={1} title="Source Configuration" lines="1-3">

Configure the source type and service name for your MongoDB connector.

</ContentSection>

<ContentSection id={2} title="Username" lines="7">

**username**: Username to connect to Mongodb. This user must have access to perform `find` operation on collection and `listCollection` operations on database available in MongoDB.

</ContentSection>

<ContentSection id={3} title="Password" lines="8">

**password**: Password to connect to MongoDB.

</ContentSection>

<ContentSection id={4} title="Host Port" lines="9">

**hostPort**: When using the `mongodb` connecion schema, the hostPort parameter specifies the host and port of the MongoDB. This should be specified as a string in the format `hostname:port`. E.g., `localhost:27017`. When using the `mongodb+srv` connection schema, the hostPort parameter specifies the host and port of the MongoDB. This should be specified as a string in the format `hostname`. E.g., `cluster0-abcde.mongodb.net`.

Using Atlas? Follow [this guide](https://www.mongodb.com/docs/guides/atlas/connection-string/) to get the connection string.

</ContentSection>

<ContentSection id={5} title="Database Name" lines="12">

**databaseName**: Optional name to give to the database in OpenMetadata. If left blank, we will use default as the database name.

</ContentSection>

<ContentSection id={6} title="Connection Options" lines="13-56">

#### Advanced Configuration

**Connection Options (Optional)**: Enter the details for any additional connection options that can be sent to database during the connection. These details must be added as Key-Value pairs.

</ContentSection>

<ContentSection id={7} title="Source Config" lines="13-56">

<SourceConfigDef />

</ContentSection>

<ContentSection id={8} title="Sink Configuration" lines="57-59">

<IngestionSinkDef />

</ContentSection>

<ContentSection id={9} title="Workflow Configuration" lines="60-76">

<WorkflowConfigDef />

</ContentSection>

</ContentPanel>

<CodePanel fileName="mongodb_config.yaml">

```yaml
source:
  type: mongodb
  serviceName: local_mongodb
  serviceConnection:
    config:
      type: MongoDB
      username: username
      password: password
      hostPort: localhost:27017
      # connectionOptions:
      #   key: value
      databaseName: custom_database_name
```

<SourceConfig />

<IngestionSink />

<WorkflowConfig />

</CodePanel>

</CodePreview>

<IngestionCli />
## Data Profiler
The Data Profiler workflow will be using the `orm-profiler` processor.
After running a Metadata Ingestion workflow, we can run Data Profiler workflow.
While the `serviceName` will be the same to that was used in Metadata Ingestion, so the ingestion bot can get the `serviceConnection` details from the server.
### Limitations
The MongodDB data profiler current supports only the following features:
1. **Row count**: The number of rows in the collection. Sampling or custom query is not supported.
2. **Sample data:** If a custom query is defined it will be used for sample data.
### 1. Define the YAML Config

This is a sample config for the profiler:

<CodePreview>

<ContentPanel>

<ContentSection id={1} title="Source Configuration" lines="1-3">

#### Source Configuration - Source Config

You can find all the definitions and types for the  `sourceConfig` [here](https://github.com/open-metadata/OpenMetadata/blob/main/openmetadata-spec/src/main/resources/json/schema/metadataIngestion/databaseServiceProfilerPipeline.json).

**generateSampleData**: Option to turn on/off generating sample data.

</ContentSection>

<ContentSection id={2} title="Process PII Sensitive" lines="76">

**processPiiSensitive**: Optional configuration to automatically tag columns that might contain sensitive information.

</ContentSection>

<ContentSection id={3} title="Timeout Seconds" lines="76">

**timeoutSeconds**: Profiler Timeout in Seconds

</ContentSection>

<ContentSection id={4} title="Schema Filter Pattern" lines="43">

**schemaFilterPattern**: Regex to only fetch tables or databases that matches the pattern.

</ContentSection>

<ContentSection id={5} title="Table Filter Pattern" lines="50">

**tableFilterPattern**: Regex to only fetch tables or databases that matches the pattern.

</ContentSection>

<ContentSection id={6} title="Processor Configuration" lines="76">

#### Processor Configuration

Choose the `orm-profiler`. Its config can also be updated to define tests from the YAML itself instead of the UI:

**tableConfig**: `tableConfig` allows you to set up some configuration at the table level.

</ContentSection>

<ContentSection id={7} title="Sink Configuration" lines="57-59">

#### Sink Configuration

To send the metadata to OpenMetadata, it needs to be specified as `type: metadata-rest`.

</ContentSection>

<ContentSection id={8} title="Workflow Configuration" lines="60-76">

#### Workflow Configuration

The main property here is the `openMetadataServerConfig`, where you can define the host and security provider of your OpenMetadata installation.

For a simple, local installation using our docker containers, this looks like:

</ContentSection>

</ContentPanel>

<CodePanel fileName="mongodb_profiler_config.yaml">

```yaml
source:
  type: monogodb
  serviceName: local_mongodb
  sourceConfig:
    config:
      type: Profiler
      generateSampleData: true
      processPiiSensitive: false
      # timeoutSeconds: 43200
      # schemaFilterPattern:
      #   includes:
      #     - schema1
      #     - schema2
      #   excludes:
      #     - schema3
      #     - schema4
      # tableFilterPattern:
      #   includes:
      #     - table1
      #     - table2
      #   excludes:
      #     - table3
      #     - table4
processor:
  type: orm-profiler
  config: {}  # Remove braces if adding properties
    # tableConfig:
    #   - fullyQualifiedName: <table fqn>
    #     profileQuery: <query to use for fetching the sample data>
sink:
  type: metadata-rest
  config: {}
workflowConfig:
  # loggerLevel: DEBUG  # DEBUG, INFO, WARN or ERROR
  openMetadataServerConfig:
    hostPort: <OpenMetadata host and port>
    authProvider: <OpenMetadata auth provider>
```

</CodePanel>

</CodePreview>

- You can learn more about how to configure and run the Profiler Workflow to extract Profiler data and execute the Data Quality from [here](/how-to-guides/data-quality-observability/profiler/profiler-workflow)
### 2. Prepare the Profiler DAG

Here, we follow a similar approach as with the metadata and usage pipelines, although we will use a different Workflow class:

<CodePreview>

<ContentPanel>

<ContentSection id={1} title="Import Necessary Modules" lines="76">

#### Import necessary modules

The `ProfilerWorkflow` class that is being imported is a part of a metadata orm_profiler framework, which defines a process of extracting Profiler data.

Here we are also importing all the basic requirements to parse YAMLs, handle dates and build our DAG.

</ContentSection>

<ContentSection id={2} title="Default Arguments" lines="76">

**Default arguments for all tasks in the Airflow DAG.**

- Default arguments dictionary contains default arguments for tasks in the DAG, including the owner's name, email address, number of retries, retry delay, and execution timeout.

</ContentSection>

<ContentSection id={3} title="Config" lines="5-12">

- **config**: Specifies config for the profiler as we prepare above.

</ContentSection>

<ContentSection id={4} title="Workflow Function" lines="76">

- **metadata_ingestion_workflow()**: This code defines a function `metadata_ingestion_workflow()` that loads a YAML configuration, creates a `ProfilerWorkflow` object, executes the workflow, checks its status, prints the status to the console, and stops the workflow.

</ContentSection>

<ContentSection id={5} title="DAG Definition" lines="76">

- **DAG**: creates a DAG using the Airflow framework, and tune the DAG configurations to whatever fits with your requirements
- For more Airflow DAGs creation details visit [here](https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html#declaring-a-dag).

</ContentSection>

</ContentPanel>

<CodePanel fileName="mongodb_profiler_dag.py">

```python
import pathlib
import yaml
from datetime import timedelta
from airflow import DAG

from metadata.profiler.api.workflow import ProfilerWorkflow

default_args = {
    "owner": "user_name",
    "email": ["username@org.com"],
    "execution_timeout": timedelta(minutes=60),
    "retries": 3,
    "retry_delay": timedelta(minutes=5),
}

config = """
<your YAML configuration>
"""

def metadata_ingestion_workflow():
    workflow_config = yaml.safe_load(config)
    workflow = ProfilerWorkflow.create(workflow_config)
    workflow.execute()
    workflow.raise_from_status()
    workflow.print_status()
    workflow.stop()

with DAG(
    "profiler_example",
    default_args=default_args,
    description="An example DAG which runs the ProfilerWorkflow",
    start_date=datetime(2021, 1, 1),
    is_paused_upon_creation=False,
    catchup=False,
) as dag:
    ingest_task = PythonOperator(
        task_id="profile_and_test_using_recipe",
        python_callable=metadata_ingestion_workflow,
    )
```

</CodePanel>

</CodePreview>
## dbt Integration
<Columns cols={2}>
<Card title="dbt Integration" href="/connectors/ingestion/workflows/dbt">
  Learn more about how to ingest dbt models
</Card>
</Columns>
